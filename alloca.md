Linux下面有一个很有意思的函数——alloca，可以从栈里动态分配内存

作用：

​		这个函数的作用是可以**从栈里动态分配内存**，如果**函数A中的某个局部变量在定义时并不知道它有多大，那么就可以将需要使用的空间大小通过函数A的某个参数传递进来，在函数A内部使用alloca分配一块栈内存**，alloca函数返回的是这块内存的首指针；**不用担心内存泄露问题，因为在函数A返回时，通过alloca申请的内存就会被自动释放掉**。

 

优点：

这个函数的优点其实很明显：

​		1、有了这个函数，如何定义**某个不确定大小的局部变量就变成了简单的问题**。其实关于这点，**使用malloc函数也可实现，只不过需要程序员自己释放不需要使用的内存，否则就内存泄露啦^_^**

​		2、**程序员只需要分配空间，释放空间的事情由alloca函数提供的机制来完成**

 

缺点：

1、如果alloca函数导致栈溢出，程序的行为就undefined了，就是不确定、不可控了，很危险的一个bug

2、可移植性很差，对编译器和平台有很强的依赖性，在很多系统上的实现是有bug的，所以并不鼓励使用。32v、pwb、pwb.2、3bsd、4bsd支持这个函数的实现，Linux使用的是GUN版本，在POSIX和SUSv3系统上是不支持该函数的

 

需要注意的是，很多系统上，alloca函数分配的内存不能被当做某个函数F的参数使用，因为分配到的内存块会被当做参数保存在函数F的栈中。还有在GNU版本下，alloca函数还有一些需要注意的地方，没看懂。。。

 

虽然alloca函数不被推荐使用，但是在Linux系统上，alloca函数却是一个非常好的用但没有被人们认识到的工具，它表现的异常出色（在各种架构下，通过alloca分配内存就和增加栈指针一样简单），比malloc的性能要好很多，因为它的申请、释放效率很高。对于Linux下较小内存的分配，alloca能收获让人激动的性能
